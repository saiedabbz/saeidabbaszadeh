{% load static %}

<section id="services">
  <div id="fadeinanimation" class="container-fluid bg-color-1">
    <div class="padding">
      <p class="font-services pad-bot">خدمات امنیتی</p>
    </div>
    <div class="container"><hr/></div>
    <div class="row padding services reveal fade-right">
      {% for serv in services  %}
      <div class="col-lg-3 col-md-6 hideme kh-p service-card">
        <a href="/service/{{ serv.slug }}/"><img src={% if serv.image %}{{ serv.image.url }}{% else %}#{% endif %} /></a>
        <a href="/service/{{ serv.slug }}/"><p>{{ serv.title }}</p></a>
      </div>
      {% endfor %}
    </div>
  </div>
</section>


<section id="software">
  <div id="fadeinanimation" class="container flip bg-color-2">
    <div class="padding"><p class="font-services pad-bot">نرم افزار های امنیتی</p></div>
    <div class="container"><hr/>
      <div class="row" style="padding-top: 96px;">
        {% if categories %}
          {% for cat in categories %}
            <div class="col-lg-3 col-md-12 reveal fade-left">
              <div class="flip-card">
                  <div class="flip-card-inner">
                    <div class="flip-card-front">
                      <div class="flip-logo">
                        <img src="{{ cat.image.url }}" alt="Avatar">
                      </div>
                      <div>
                        <p>{{ cat.title }}</p>
                      </div>
                    </div>
                    <div class="flip-card-back">
                      <div class="back-face">
                        {% for sub_cat in cat.collection_set.all%}
                          {% comment %} <a class="btn btn-flip" href="/products/{{sub_cat.id}}/">{{sub_cat.title}}</a><br><br> {% endcomment %}
                          <a class="btn btn-flip" href="/products/{{sub_cat.slug}}/">{{sub_cat.title}}</a><br><br>
                        {% endfor %}
                      </div>
                    </div>
                  </div>
              </div><br/>
            </div>
            {% endfor %}
          {% endif %} 
      </div>
    </div>
  </div>
</section>



<section id="bestproducts" style="background-color:#fff;">
  <div class="container">
    <div class="row techvio">
      <div class="col-lg-6">
        <div class="img-animation col-s-12" style="float:left;">
          <img style="padding-top: 25px;" src="{% static 'img/choose-1.jpg' %}" alt="image">
        </div>
      </div>
      <div class="col-lg-6">
        <div class="overview-content">
          <h6>محصولات سازمانی</h6>
          <h2>محبوب ترین محصولات</h2>
          <p>راهکار های امنیتی برای حفاظت از داده های تجاری و سازمانی و کاربران سیستم.</p>
          <ul class="features-list">
 
            {% for product in top_products.business %}
              <a href="/product/{{product.slug}}/"><li><span>{{ product.title}}
                <img style="height: 33px;" src="{{ product.images.first.image.url }}" alt="{{ cat.title }}"/>
              </span></li></a>
            {% endfor%}
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>
<section style="background-color:#fff;">
  <div class="container">
    <div class="row techvio">
      <div class="col-lg-6">
        <div class="overview-content">
          <h6>محصولات خانگی</h6>
          <h2>محبوب ترین محصولات</h2>
          <p>ایده آل برای خانه یا دفاتر کوچک که به دنبال امنیت دستگاه با کاربری آسان هستند.</p>
          <ul class="features-list">
            {% for product in top_products.home %}
              <a href="/product/{{product.slug}}/"><li><span>{{ product.title}}
                <img style="height: 33px;" src="{{ product.images.first.image.url }}" alt="{{ cat.title }}"/>
              </span></li></a>
            {% endfor%}
          </ul>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="img-animation" style="float:left;">
          <img style="padding-top: 25px;" src="{% static 'img/choose-2.jpg' %}" alt="image">
        </div>
      </div>
    </div>
  </div>
</section>


<body onload="load()">
  <section class="counter-area section-padding-bg">
    <div class="container" >
      <div class="row" style="direction:rtl;">

        <div class="col-lg-4 col-md-6 counter-item">
          <div class="single-counter">
            <div class="counter-content">
              <h2>
                <span>+</span>
                <span id='0101' class="counter">{{g_configs.org_users.value}}</span>
              </h2>
              <h3 class="counter-heading">{{g_configs.org_users.title}}</h3>
            </div>
          </div>
        </div>

        <div class="col-lg-4 col-md-6 counter-item">
          <div class="single-counter">
            <div class="counter-content">
              <h2>
                <span>+</span>
                <span id='0102' class="counter">{{g_configs.home_users.value}}</span>
              </h2>
              <h3 class="counter-heading">{{g_configs.home_users.title}}</h3>
            </div>
          </div>
        </div>

        <div class="col-lg-4 col-md-6 counter-item">
          <div class="single-counter">
            <div class="counter-content">
              <h2>
                <span>+</span>
                <span id='0103' class="counter">{{g_configs.users_count.value}}</span>
              </h2>
              <h3 class="counter-heading">{{g_configs.users_count.title}}</h3>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>
</body>

<section id="customers">
  <div class="container bg-color-1">
    <div class="padding">
      <p class="font-services pad-bot"> مشتری ها</p>
    </div>
    <hr/>
    
    <div id="fadeinanimation" class="swiper mySwiper" style="height: 350px">
      <div class="swiper-wrapper">
        {% for customer in customers  %}
          <div class="swiper-slide disp_customer">
              <div class="Card_card_customer reveal fade-bottom">
                <div class="row row-logo-card-customer">
                  <img src="{{ customer.image.url }}"/>
                </div>
                <div class="row slide-item-top customer_title">
                  <p>{{ customer.title }}</p>
                </div>
              </div>
          </div>
        
        {% endfor %}
      </div>
      <div class="swiper-button-next"></div>
      <div class="swiper-button-prev"></div>
      <div class="swiper-pagination"></div>
    </div>

  </div>
</section>



<script>
  function reveal() {
    var reveals = document.querySelectorAll(".reveal");
  
    for (var i = 0; i < reveals.length; i++) {
      var windowHeight = window.innerHeight;
      var elementTop = reveals[i].getBoundingClientRect().top;
      var elementVisible = 150;
  
      if (elementTop < windowHeight - elementVisible) {
        reveals[i].classList.add("active");
      } else {
        reveals[i].classList.remove("active");
      }
    }
  }
  
  window.addEventListener("scroll", reveal);
</script>

<script>
  function animate(obj, initVal, lastVal, duration) {
     let startTime = null;

  let currentTime = Date.now();

  const step = (currentTime ) => {

  if (!startTime) {
     startTime = currentTime ;
  }

  const progress = Math.min((currentTime - startTime)/ duration, 1);

  obj.innerHTML = Math.floor(progress * (lastVal - initVal) + initVal);

  if (progress < 1) {
     window.requestAnimationFrame(step);
  } else {
        window.cancelAnimationFrame(window.requestAnimationFrame(step));
     }
  };
  //start animating
     window.requestAnimationFrame(step);
  }
  let text1 = document.getElementById('0101');
  let text2 = document.getElementById('0102');
  let text3 = document.getElementById('0103');

  const load = () => {
     animate(text1, 50, {{g_configs.org_users.value}}, 7000);
     animate(text2, 50, {{g_configs.home_users.value}}, 7000);
     animate(text3, 100, {{g_configs.users_count.value}}, 7000);

  }
</script>


<script>

  var swiper = new Swiper(".mySwiper", {
    slidesPerView: 5,
    spaceBetween: 20,
    slidesPerGroup: 1,
    loop: true,
    loopFillGroupWithBlank: true,
    pagination: {
      el: ".swiper-pagination",
      clickable: true,
    },
    navigation: {
      nextEl: ".swiper-button-next",
      prevEl: ".swiper-button-prev",
    },
    breakpoints: {
        // when window width is <= 499px
        600: {
            slidesPerView: 1,
            spaceBetweenSlides: 20
        },
        // when window width is <= 999px
        999: {
            slidesPerView: 5,
            spaceBetweenSlides: 20
        }
    }
  });



  Vue.config.devtools = true;

  Vue.component('card', {
    template: `
      <div class="card-wrap"
        @mousemove="handleMouseMove"
        @mouseenter="handleMouseEnter"
        @mouseleave="handleMouseLeave"
        ref="card">
        <div class="card"
          :style="cardStyle">
          <div class="card-bg" :style="[cardBgTransform, cardBgImage]"></div>
          <div class="card-info">
            <slot name="header"></slot>
            <slot name="content"></slot>
          </div>
        </div>
      </div>`,
    mounted() {
      this.width = this.$refs.card.offsetWidth;
      this.height = this.$refs.card.offsetHeight;
    },
    props: ['dataImage'],
    data: () => ({
      width: 0,
      height: 0,
      mouseX: 0,
      mouseY: 0,
      mouseLeaveDelay: null }),
  
    computed: {
      mousePX() {
        return this.mouseX / this.width;
      },
      mousePY() {
        return this.mouseY / this.height;
      },
      cardStyle() {
        const rX = this.mousePX * 30;
        const rY = this.mousePY * -30;
        return {
          transform: `rotateY(${rX}deg) rotateX(${rY}deg)` };
  
      },
      cardBgTransform() {
        const tX = this.mousePX * -40;
        const tY = this.mousePY * -40;
        return {
          transform: `translateX(${tX}px) translateY(${tY}px)` };
  
      },
      cardBgImage() {
        return {
          backgroundImage: `url(${this.dataImage})` };
  
      } },
  
    methods: {
      handleMouseMove(e) {
        this.mouseX = e.pageX - this.$refs.card.offsetLeft - this.width / 2;
        this.mouseY = e.pageY - this.$refs.card.offsetTop - this.height / 2;
      },
      handleMouseEnter() {
        clearTimeout(this.mouseLeaveDelay);
      },
      handleMouseLeave() {
        this.mouseLeaveDelay = setTimeout(() => {
          this.mouseX = 0;
          this.mouseY = 0;
        }, 1000);
      } } });
  
  
  
  const app = new Vue({
    el: '#app' });

</script>